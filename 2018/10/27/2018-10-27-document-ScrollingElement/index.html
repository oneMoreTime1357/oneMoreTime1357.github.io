<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 「work bug」document.scrollingElement scrollTop 的问题 · MissYang</title><meta name="description" content="「work bug」document.scrollingElement scrollTop 的问题 - Sunny Yang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yikeshu.info/atom.xml" title="MissYang"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon-logo.png" alt="logo"><span>Sunny Yang</span></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/oneMoreTime1357" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="https://www.jianshu.com/u/459674901bd7" target="_blank" class="nav-list-link">JANSHU</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">「work bug」document.scrollingElement scrollTop 的问题</h1><div class="post-info">Oct 27, 2018</div><div class="post-content"><p>最近在检测网页异常情况，添加了监测的系统，跑了一段时间，发现报错最多的就是<code>Cannot read &#39;scrollTop&#39; of undefined</code>设备大多数基本上都是Android手机</p>
<p>检查了一下代码发现，有用到scrollTop的时候只有在滚动加载的时，获取页面滚动的高度，代码如下</p>
<pre><code>document.scrollingElement.scrollTop
</code></pre><p>只有这个地方用到了scrollTop，难道是<code>scrollingElement</code>的问题，于是查找了一些资料，如下</p>
<p>引用<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/scrollingElement" target="_blank" rel="noopener">MDN</a>文档解释Document.scrollingElement的作用</p>
<blockquote>
<p><code>scrollingElement</code>（Document的只读属性）返回滚动文档的<code>Element</code>对象的引用。在标准模式下，这是文档的根元素，<code>document.documentElement</code><br>当在怪异模式下，<code>scrollingElement</code>属性返回HTML <code>body</code>元素（若不存在返回null）</p>
</blockquote>
<p>也就是说<code>scrollingElement</code>在标准模式下可以被当做文档的根元素，不过现在大部分网页都是标准模式下。那接下来就看看兼容性问题。</p>
<h3 id="scrollingElement-兼容性"><a href="#scrollingElement-兼容性" class="headerlink" title="scrollingElement 兼容性"></a>scrollingElement 兼容性</h3><p><strong>PC端兼容性</strong><br><img src="http://oybj22zxs.bkt.clouddn.com/屏幕快照 2018-10-25 下午7.03.14.png" alt="PC"></p>
<p><strong>手机端兼容性</strong><br><img src="http://oybj22zxs.bkt.clouddn.com/屏幕快照 2018-10-25 下午7.03.35.png" alt="手机端"></p>
<p>看这两张图就能看出来，兼容性并不是很好，Android并不支持此对象，所以在Android手机上会报错。<br>那除了这元素，还有什么办法获取页面内容的滚动高度呢？</p>
<p>看过这个<a href="https://jsfiddle.net/xvrdaacf/3/" target="_blank" rel="noopener">jsfiddle</a>发现还可以使用<code>document.body</code>和<code>document.documentElement</code>的方式，我分别将这个jsfiddle在Chrome浏览器下运行，和在Safari下运行得到的结果却不同，结果如下：</p>
<p><strong>Chrome执行结果</strong></p>
<pre><code>document.documentElement.scrollTop: 77 
document.body.scrollTop: 0 
document.scrollingElement.scrollTop: 77
</code></pre><p><strong>Safari执行结果</strong></p>
<pre><code>document.documentElement.scrollTop: 0
document.body.scrollTop: 77
document.scrollingElement.scrollTop: 77
</code></pre><p>对比结果就发现，在Chrome中document.body.scrollTop获取到的值为0，而在Safari中是有值的，但document.documentElement.scrollTop却没有值得到0</p>
<h3 id="兼容性解答方法获取scrollTop"><a href="#兼容性解答方法获取scrollTop" class="headerlink" title="兼容性解答方法获取scrollTop"></a>兼容性解答方法获取scrollTop</h3><pre><code>const scrollTop = Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop)
</code></pre><p>看了好多资料都说<code>document.documentElement.scrollTop</code>已经弃用，但是Safari还是可以用的，难道兼容了。更安全的写法就是上面都兼容下</p>
<p>或者把scrollingElement也加上</p>
<pre><code>function pageScrollTop {
  if (document.scrollingElement) {
    return document.scrollingElement.scrollTop
  }

  return Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop)
}
</code></pre><p><strong>参考链接：</strong></p>
<p><a href="https://stackoverflow.com/questions/28633221/document-body-scrolltop-firefox-returns-0-only-js" target="_blank" rel="noopener">https://stackoverflow.com/questions/28633221/document-body-scrolltop-firefox-returns-0-only-js</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/10/17/Promise-all-handle-error/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'http-yikeshu-info';
var disqus_identifier = '2018/10/27/2018-10-27-document-ScrollingElement/';
var disqus_title = '「work bug」document.scrollingElement scrollTop 的问题';
var disqus_url = 'http://yikeshu.info/2018/10/27/2018-10-27-document-ScrollingElement/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//http-yikeshu-info.disqus.com/count.js" async></script><div class="copyright"><p>© 2017 - 2018 <a href="http://yikeshu.info">Sunny Yang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/oneMoreTime1357/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>